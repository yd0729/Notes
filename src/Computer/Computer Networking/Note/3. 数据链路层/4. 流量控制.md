# 4. 流量控制

保证发送速度和接受速度相匹配．

- 数据链路层的流量控制：点对点，接收方收不下就不回复确认．
- 传输层的流量控制：端到端，接收端会发送窗口公告．

## 滑动窗口

|协议|发送窗口大小|接收窗口大小|
|:---:|:---:|:---:|
停止-等待协议|1|1|
后退 N 帧协议（GBN）|> 1|1
选择重传协议（SR）|> 1|> 1

## 停止-等待协议

发了一个之后开始等，保存副本．

超时计时器 > 平均 RTT

超时没收到 ACK ，就重传．

接收方收到重复的帧也会重复确认帧．

ACK 是有顺序的，发送方如果收到了当前应该收到的 ACK 之前的 ACK ，就会直接丢弃．

$$
信道利用率=\cfrac{T_{Data}}{T_{Data}+\text{RTT}+T_{ACK}}
$$

## 后退 N 帧协议（GBN）

在停止-等待的基础上：

在没收到确认前最多可发 n 个，而不是 1 个．

超时 1 帧，就会重传所有未确认的帧．

ACK 是有顺序的，在这个协议里用来累积确认．

接收方只能按序接收，其余情况直接丢弃．

窗口的大小受限于帧的编号的范围，太大的话接收方就无法确认是新帧还是旧帧．

捎带确认指的是如果接收方有给发送方的数据，或者双方就是在双向通信，那在发送时也可以捎带着对对方数据的 ACK ，但很显然这和用什么协议没关系．

> ![图 1](../../../../.media/8291af430c6d9c2fe837a3b0fdf30f92b4847663c7e4fe250b7b1df8f24ed662.png)  
>
> 甲只要 80 ms 就能把窗口全部发送到信道上，而收到乙的第一个确认帧需要 100 ms ，所以得按照 100 ms 算．
>
> 假设甲需要 > 100 ms 才能把窗口全部发送到信道上，那就是真正的连续发送了，信道利用率在稳定时可以达到 100 % ，最大数据传输率就是 100 Mb / s ．

## 选择重传协议（Selective Repeat）

由于需要只重传出错的帧，所以不能累积确认，只能单个确认．
